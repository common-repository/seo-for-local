!function(){if(void 0===window.wptMlsl.disable_gmap_script||!window.wptMlsl.disable_gmap_script){const t=window.document.createElement("script");t.src=`https://maps.googleapis.com/maps/api/js?v=3&key=${window.wptMlsl.GmKey}&ver=${window.wptMlsl.pv}&libraries=places,geometry`,t.async=!0,t.defer=!0,window.document.body.appendChild(t)}}(),window.wptMlslLocationMapInit=function(){let t=0;const o=window.jQuery("#et-fb-app").length;let e=setInterval((function(){void 0!==window.google&&void 0!==window.google.maps&&(t++,window.jQuery(".wpt-mlsl-location-map").each((function(){let t=window.jQuery(this),o=t.closest(".wpt-mlsl-location-map-container");if(!o.data("map")){const e=parseFloat(t.data("lat")),a=parseFloat(t.data("lng")),i=parseInt(t.data("zoom")),s={lat:e,lng:a},n="on"===t.data("show-info-window");let l={};"on"===t.data("show-map-type-control")&&(l={mapTypeIds:t.data("map-type-control-map-types"),position:google.maps.ControlPosition[t.data("map-control-position")]});let r={};"on"===t.data("show-zoom-control")&&(r={position:google.maps.ControlPosition[t.data("zoom-control-position")]});let c={};"on"===t.data("show-street-view-control")&&(c={position:google.maps.ControlPosition[t.data("street-view-control-position")]});let d={};"on"===t.data("show-rotate-control")&&(d={position:google.maps.ControlPosition[t.data("rotate-control-position")]});let p={};"on"===t.data("show-fullscreen-control")&&(p={position:google.maps.ControlPosition[t.data("fullscreen-control-position")]});let m={zoom:i,center:s,gestureHandling:t.data("gesture-handling"),mapTypeId:t.data("map-type"),fullscreenControl:"on"===t.data("show-fullscreen-control"),fullscreenControlOptions:p,rotateControl:"on"===t.data("show-rotate-control"),rotateControlOptions:d,streetViewControl:"on"===t.data("show-street-view-control"),streetViewControlOptions:c,scaleControl:"on"===t.data("show-scale-control"),mapTypeControl:"on"===t.data("show-map-type-control"),mapTypeControlOptions:l,zoomControl:"on"===t.data("show-zoom-control"),zoomControlOptions:r};t.data("map-style")&&"object"==typeof t.data("map-style")&&(m.styles=t.data("map-style"));let w=new window.google.maps.Map(window.jQuery(this)[0],m);o.data("map",w);const h=t.data("marker-animation");let g={position:s,map:w,title:t.data("location-title")};"NONE"!==h&&(g.animation=google.maps.Animation[h]),t.data("marker-icon")&&(g.icon={url:t.data("marker-icon")});let u=new google.maps.Marker(g);if(n){const t=new google.maps.InfoWindow({content:o.find(".wpt-map-info-window").html()});u.addListener("click",(()=>{t.open({anchor:u,map:w,shouldFocus:!1})}))}o.data("marker",u)}})),!o&&t>20&&clearInterval(e))}),o?500:200)},window.wptMlslLocationMapInit(),function(){const t=window.jQuery("#et-fb-app").length;let o=setInterval((function(){window.wptMlslSetupStoreLocator(o)}),t?500:200)}(),window.wptMlslStoreLocator={locations:[],categoryOptions:[],map:void 0,bounds:void 0,markers:[],el:void 0,autocomplete:void 0,place:void 0,circle:void 0,myLocationMarker:void 0,submitBtn:void 0,categoryEl:void 0,radiusEl:void 0,listEl:void 0,inputBoxEl:void 0,markerCluster:void 0,visibleMarkers:[],showInfoWindow:!0,showEmail:!0,showAddress:!0,showTelephone:!0,showTitle:!0,showDescription:!0,showDirection:!0,init:function(t,o,e,a,i){this.locations=t,this.categoryOptions=o,this.map=e,this.bounds=a,this.el=i,this.markers=[],this.submitBtn=this.el.find(".search_button"),this.categoryEl=this.el.find('[name="sl-category"]'),this.radiusEl=this.el.find('[name="sl-radius"]'),this.listEl=this.el.find(".sl-listing"),this.inputBoxEl=this.el.find('[name="sl-address"]'),this.showInfoWindow="on"===this.el.data("show-info-window"),this.showEmail="on"===this.el.data("show-email"),this.showTelephone="on"===this.el.data("show-tel"),this.showAddress="on"===this.el.data("show-address"),this.showTitle="on"===this.el.data("show-title"),this.showDescription="on"===this.el.data("show-description"),this.showDirection="on"===this.el.data("show-direction-link"),this.showLocationsOnInit="on"===this.el.data("show-locations-on-init"),this.myLocationMarker=new google.maps.Marker({position:e.getCenter(),icon:{url:this.el.data("your-location-icon")}}),this.myLocationMarker.setMap(this.map),"on"!==i.data("ask-to-share-location")||wptMlsl.isVisualBuilder||this.setMyCurrentLocation(),this.createLocationMarkers(),this.addCategoryOptions(),this.initAutoComplete();let s=this;this.radiusEl.on("change",(function(){s.search()})),this.categoryEl.on("change",(function(){s.search()})),s.showLocationsOnInit&&s.search()},setMyCurrentLocation:function(){let t=this;window.navigator.geolocation.getCurrentPosition((function(o){const e={lat:o.coords.latitude,lng:o.coords.longitude};t.myLocationMarker.setPosition(e),t.map.setCenter(e)}),(function(t){console.log(t)}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})},createLocationMarkers:function(){let t=this;this.locations.forEach((function(o,e){!function(o){let e=t.el.data("default-marker");const a={lat:parseFloat(o.lat),lng:parseFloat(o.lng)},i=new google.maps.Marker({position:a,categories:o.categories,location:o});o.marker_icon&&(e=o.marker_icon),e&&i.setIcon(e),t.markers[o.id]=i}(o)}))},addCategoryOptions:function(){let t=this.el.find('[name="sl-category"]');this.categoryOptions.forEach((function(o){t.append(`<option value="${o.term_id}">${o.name}</option>`)}))},initAutoComplete:function(){let t=this,o=this.el.find('[name="sl-address"]');var e=[];this.el.data("restrict-by-countries")&&(e=this.el.data("restrict-by-countries").split(",")),this.autocomplete=new google.maps.places.Autocomplete(o[0]),this.autocomplete.setOptions({types:[],bounds:this.bounds}),e&&this.autocomplete.setComponentRestrictions({country:e}),this.autocomplete.setFields(["geometry","formatted_address"]),this.autocomplete.addListener("place_changed",(function(){var e=t.autocomplete.getPlace();if(!e.geometry)return this.place=void 0,void console.log("cleared");if(e.geometry){t.place=e;let o={lat:e.geometry.location.lat(),lng:e.geometry.location.lng()};t.myLocationMarker.setPosition(o),t.map.setCenter(o),t.search()}else this.place=void 0;e.formatted_address&&o.val(e.formatted_address)}))},getRadius:function(){let t=this.el.find('[name="sl-radius"]').val();return!!t&&(t=parseInt(t),"mile"===this.el.data("distance-unit")?t*=1609.34:t*=1e3,t)},search:function(){let t=this;t.listEl.empty(),t.visibleMarkers=[];let o=new google.maps.LatLngBounds;o.extend(t.myLocationMarker.getPosition());let e=t.el.data("distance-unit"),a=t.el.find('[name="sl-category"]').val(),i=t.getRadius();void 0!==t.circle&&t.circle.setMap(null),i&&(t.circle=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:t.map,center:t.myLocationMarker.getPosition(),radius:i}),o.union(t.circle.getBounds())),t.markers.forEach((function(s){s.setMap(null),void 0!==s.wpInfoWindow&&s.wpInfoWindow.close();let n=s.location,l=google.maps.geometry.spherical.computeDistanceBetween(t.myLocationMarker.getPosition(),new google.maps.LatLng(n.lat,n.lng));i&&l>i?s.setVisible(!1):!a||n.categories.includes(parseInt(a))?(s.location.distanceFormatted="mile"===e?parseFloat(l/1609.34).toFixed(2)+" miles":parseFloat(l/1e3).toFixed(2)+" km",s.location.distance=l,t.visibleMarkers.push(s),s.setVisible(!0),o.extend(s.getPosition())):s.setVisible(!1)})),t.visibleMarkers.sort((function(t,o){return t.location.distance-o.location.distance})),t.visibleMarkers.forEach((function(o){"off"===t.el.data("show-cluster-markers")&&o.setMap(t.map);let e=t.getLocationInfo(o.location);if(t.listEl.append(e),t.showInfoWindow){let a=null;a=void 0===o.wpInfoWindow?new google.maps.InfoWindow({content:e}):o.wpInfoWindow,o.wpInfoWindow=a,o.wpInfoWindow.setContent(e),google.maps.event.clearInstanceListeners(o,"click"),o.addListener("click",(()=>{t.visibleMarkers.forEach((function(t){t!==o&&void 0!==t.wpInfoWindow&&t.wpInfoWindow.close()})),a.open({anchor:o,map:t.map,shouldFocus:!1})}))}})),"on"===t.el.data("show-cluster-markers")&&(void 0!==t.markerCluster&&t.markerCluster.removeMarkers(t.markerCluster.getMarkers()),t.markerCluster=new window.MarkerClusterer(t.map,t.visibleMarkers,{imagePath:`${window.wptMlsl.plugin_url}/images/`})),t.map.fitBounds(o),t.visibleMarkers.length||t.listEl.append(`<h3 class="mlsl-empty-results-text">${t.el.data("empty-results-text")}</h3>`)},getLocationInfo:function(t){let o=[];this.showAddress&&o.push(`<div><img class='sl-contact-icon' src="${this.el.data("pin-icon")}"/><address class='sl-address'>${t.formatted_address}</address></div>`),this.showTelephone&&t.tel&&o.push(`<div><a href="tel:${t.tel}"><img class='sl-contact-icon' src="${this.el.data("tel-icon")}"/></a><a class='sl-tel' href="tel:${t.tel}">${t.tel}</a></div>`),this.showEmail&&t.email&&o.push(`<div><a href="mailto:${t.email}"><img class='sl-contact-icon' src="${this.el.data("email-icon")}"/></a><a class='sl-email' href="mailto:${t.email}">${t.email}</a></div>`);let e="";this.showTitle&&t.title&&(e+=`<h3><a class='sl-location-title' href="${t.url}" target="blank">${t.title}</a></h3>`),o.length&&(e+=`<div class="contact-details">${o.join('<span class="sl-separator"> | </span>')}</div>`),e&&(e=`<div class="title-address-wrapper">${e}</div>`);let a="";if(this.inputBoxEl.val())a=encodeURI(this.inputBoxEl.val());else{let t=this.myLocationMarker.getPosition();a=`${t.lat()},${t.lng()}`}let i="";this.showDirection&&(i='<div class="direction-wrapper">',i+=`<a target="blank" href="https://www.google.com/maps/dir/?api=1&origin=${a}&destination=${t.lat},${t.lng}"><img title='${this.el.data("direction-image-alt-title")}' class='direction-icon' src="${this.el.data("directions-icon")}"/></a>`,i+=`<div class='sl-distance-formatted'>${t.distanceFormatted}</div>`,i+="</div>");let s="";return this.showDescription&&t.excerpt&&(s=`<p class="mlsl-location-description">${t.excerpt}</p>`),`<div class="mlsl-location-list-item">\n\t\t<div class='title-address-direction-wrapper'>\n\t\t${e}\n\t\t${i}\n\t\t</div>\n\t\t${s}\n\t\t</div>`}},window.wptMlslSetupStoreLocator=function(t){let o=0;const e=window.jQuery("#et-fb-app").length;void 0!==window.google&&void 0!==window.google.maps&&(o++,window.jQuery(".wpt-mlsl-store-locator").each((function(){let o=window.jQuery(this);if("on"===o.data("show-cluster-markers")&&void 0===window.MarkerClusterer){const t=window.document.createElement("script");t.src=`${window.wptMlsl.plugin_url}/js/markerclusterplus.min.js`,t.async=!1,t.defer=!1,window.document.body.appendChild(t)}o.data("id");const e=o.data("api-url"),a=o.data("locations-per-page"),i=o.data("post-not-in"),s=o.data("post-in"),n=o.data("filter-by-categories"),l=o.data("categories"),r=o.data("show-category-dropdown");let c=o.data("map-style");c&&"object"==typeof c||(c=[]);const d=`${e}?per_page=${a}&post_not_in=${i}&post_in=${s}&show_categories=${n}&categories=${l}&categories_dropdown=${r}&t=${(new Date).getTime()}`;let p=[],m=[],w={};"on"===o.data("show-map-type-control")&&(w={mapTypeIds:o.data("map-type-control-map-types"),position:google.maps.ControlPosition[o.data("map-control-position")]});let h={};"on"===o.data("show-zoom-control")&&(h={position:google.maps.ControlPosition[o.data("zoom-control-position")]});let g={};"on"===o.data("show-street-view-control")&&(g={position:google.maps.ControlPosition[o.data("street-view-control-position")]});let u={};"on"===o.data("show-rotate-control")&&(u={position:google.maps.ControlPosition[o.data("rotate-control-position")]});let f={};"on"===o.data("show-fullscreen-control")&&(f={position:google.maps.ControlPosition[o.data("fullscreen-control-position")]});let y={center:{lat:parseFloat(o.data("lat")),lng:parseFloat(o.data("lng"))},zoom:parseInt(o.data("zoom")),gestureHandling:o.data("gesture-handling"),mapTypeId:o.data("map-type"),fullscreenControl:"on"===o.data("show-fullscreen-control"),fullscreenControlOptions:f,rotateControl:"on"===o.data("show-rotate-control"),rotateControlOptions:u,streetViewControl:"on"===o.data("show-street-view-control"),streetViewControlOptions:g,scaleControl:"on"===o.data("show-scale-control"),mapTypeControl:"on"===o.data("show-map-type-control"),mapTypeControlOptions:w,zoomControl:"on"===o.data("show-zoom-control"),zoomControlOptions:h,styles:c};if(void 0===o.data("map")){let e=new window.google.maps.Map(o.find(".sl-map-store-locator")[0],y),a=new google.maps.LatLngBounds;fetch(d).then((t=>t.json())).then((t=>{void 0!==t.locations&&(p=t.locations,m=t.categories,o.data("locations",p),o.data("categoryOptions",m),window.wptMlslStoreLocator.init(p,m,e,a,o))})),o.data("map",e),void 0!==t&&clearInterval(t),o.find(".sl-listing").append(`<h3 class="mlsl-empty-results-text">${o.data("empty-results-text")}</h3>`)}})),!e&&o>20&&clearInterval(t))};